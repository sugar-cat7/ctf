## ディレクトリトラバーサルについて

### 概要

`../`のような親ディレクトリを参照できるようなパスをパラメータをアプリケーションに与え、本来非公開であるはずのファイルを取得できてしまうような脆弱性

```bash
docker compose up
```

http://localhost:5001/ にアクセス

- どうやってディレクトリをトラバースするのか。
  - ファイルシステムでは`../`を用いて親ディレクトリを参照
  - `/home/user/../` と `/home/`と等価

デモアプリは`route_memo`に脆弱性が存在している。
パラメータ key に指定された値を結合しているが、親ディレクトリに関しての制約が一切ない。
`tmp/files/[パラメータ-keyの値]`

例えば、ローカルユーザの情報を含む`/etc/passwd`を閲覧するためには`tmp/files/`から 2 度親ディレクトリを遡ると`tmp/files/../../etc/passwd`と指定できる。

これを踏まえて`key`にパスを渡すと...

http://localhost:5001/memo?key=../../etc/passwd

- フラグの取得
  実は`init`の処理で環境変数を渡しているので、ディレクトリトラバーサルを使用してこの環境変数を見てみる。

  - 前提

    - Linux においては、プロセスの情報は`proc擬似ファイルシステム`に存在する
    - `proc擬似ファイルシステム`に存在する`environ`から環境変数を取得することが可能
    - `proc擬似ファイルシステム`は`/proc`にマウントされている
      - `/proc/[process id]/`ごとにフォルダが存在する
      - `/proc/self/`は自分自身のプロセスのフォルダを参照可能なシンボリックリンク

  - 以上を踏まえると、あるプロセスが自分自身の環境変数一覧の内容を取得するためには`/proc/self/environ`を参照すれば良い

  - http://localhost:5001/memo?key=../../proc/self/environ
